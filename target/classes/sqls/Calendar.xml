<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Cal">

<select id="getCalendar" parameterType="bit.com.a.dto.CalendarDto"
	resultType="bit.com.a.dto.CalendarDto">

	SELECT CALENDARSEQ, JOBSEQ, MEMBERID, TITLE, DEL, JOBSTART, JOBEND
	FROM (SELECT ROW_NUMBER()OVER(PARTITION BY SUBSTR(JOBSTART, 1, 8)ORDER BY JOBSTART ASC) AS RNUM,  
			CALENDARSEQ, JOBSEQ, MEMBERID, TITLE, JOBSTART, JOBEND, DEL 
		  FROM CALENDAR  
		  WHERE MEMBERID=#{memberid} AND SUBSTR(JOBSTART, 1, 6)=#{jobstart} 
		  WHERE MEMBERID=#{memberid}) 
	WHERE RNUM BETWEEN 1 AND 5
</select>

<insert id="writeCalendar" parameterType="bit.com.a.dto.CalendarDto">
	INSERT INTO CALENDAR(CALENDARSEQ, JOBSEQ, MEMBERID, JOBSTART, JOBSTART, JOBEND)
	VALUES(SEQ_CAL.NEXTVAL, #{jobseq}, #{memberid}, #{title}, #{jobstart}, #{jobend})
</insert>

<select id="getDay" parameterType="bit.com.a.dto.CalendarDto"
	resultType="bit.com.a.dto.CalendarDto">
	SELECT CALENDARSEQ, MEMBERID, TITLE, JOBSTART, JOBEND
	FROM CALENDAR
	WHERE CALENDARSEQ=#{calendarseq}
</select>

<select id="getDayList"
	parameterType="bit.com.a.dto.CalendarDto"
	resultType="bit.com.a.dto.CalendarDto">
	SELECT SEQ, MEMBERID, TITLE, JOBSTART, JOBEND
	FROM CALENDAR 
	WHERE MEMBERID=#{memberid}
</select>

<select id="getCallistmonth" parameterType="bit.com.a.dto.CalendarDto" resultType="bit.com.a.dto.CalendarDto">
	SELECT JOBSEQ, MEMBERID, TITLE, JOBSTART, JOBEND
    FROM CALENDAR WHERE MEMBERID=#{memberid}
    ORDER BY JOBSTART ASC
</select>

<!-- <update id="updateCalendar" parameterType="bit.com.a.dto.CalendarDto">
	UPDATE CALENDAR 
	SET	TITLE=#{title}, CONTENT=#{content}
	WHERE SEQ=#{seq}
</update> -->
 
</mapper>